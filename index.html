<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movies Aro - ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #111;
    color: #fff;
    margin: 0;
    padding: 0;
  }
  .site-header {
    background: #222;
    padding: 10px;
    text-align: center;
    font-size: 1.4rem;
    font-weight: bold;
    position: relative;
  }
  .user-count {
    position: absolute;
    top: 10px;
    right: 15px;
    background: #00ff88;
    color: #000;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 0.9rem;
    font-weight: bold;
  }
  #content { padding: 10px; }
  .movie-item, .category-item {
    background: #1c1c1c;
    border-radius: 8px;
    margin: 10px 0;
    padding: 10px;
    display: flex;
    align-items: center;
  }
  .movie-item img { width: 80px; height: auto; border-radius: 5px; margin-right: 10px; }
  .movie-info a { color: #00ff88; text-decoration: none; font-weight: bold; }
  .pagination { margin-top: 15px; text-align: center; }
  .pagination a { color: #ff0; margin: 0 5px; text-decoration: none; }
  .pagination_current { color: #0ff; font-weight: bold; }
  .spinner-container { display: flex; flex-direction: column; align-items: center; margin-top: 50px; }
  .spinner { border: 4px solid #333; border-top: 4px solid #0ff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
  @keyframes spin { 100% { transform: rotate(360deg); } }
  #popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); justify-content: center; align-items: center; z-index: 9999; }
  .popup-box { background: #222; padding: 20px; border-radius: 10px; text-align: center; max-width: 300px; }
  .popup-box button { background: #00ff88; border: none; padding: 10px 15px; color: #000; font-weight: bold; border-radius: 5px; cursor: pointer; }
</style>
</head>
<body>

<div class="site-header">
  üé¨ Movies Aro - ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç
  <span class="user-count">üë• <span id="userCount">0</span></span>
</div>

<button onclick="goBack()" style="margin:10px;">‚Üê Back</button>
<div id="content"></div>

<!-- Popup -->
<div id="popup">
  <div class="popup-box">
    <p>üì• Download link-‡Æï‡Øç‡Æï‡ØÅ ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤ OK ‡ÆÖ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç</p>
    <button onclick="confirmRedirect()">OK</button>
  </div>
</div>

<!-- Firebase Live User Count -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-analytics.js";
import { getDatabase, ref, set, onDisconnect, onValue } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBnY2HE2zylEONgXruGxPU_8OnN2bvVDxs",
  authDomain: "myuserscounter.firebaseapp.com",
  databaseURL: "https://myuserscounter-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "myuserscounter",
  storageBucket: "myuserscounter.firebasestorage.app",
  messagingSenderId: "326545068293",
  appId: "1:326545068293:web:2effe83b5dad263810276c",
  measurementId: "G-3ZZED15Y9G"
};

const app = initializeApp(firebaseConfig);
getAnalytics(app);
const db = getDatabase(app);

const userId = Math.random().toString(36).substring(2);
const userRef = ref(db, 'onlineUsers/' + userId);

set(userRef, true);
onDisconnect(userRef).remove();

const countRef = ref(db, 'onlineUsers');
onValue(countRef, (snapshot) => {
  const count = snapshot.size || snapshot.numChildren();
  document.getElementById('userCount').textContent = count;
});
</script>

<!-- Main SPA Script -->
<script>
const pageHistory = [];
const baseUrl = "https://isaidub.city";
let actualDownloadUrl = "";

// Load page function
async function loadPage(relativePath, isBack=false, retryCount=3){
  const container = document.getElementById("content");
  if(!isBack && (!pageHistory.length || pageHistory[pageHistory.length-1]!==relativePath)) pageHistory.push(relativePath);

  container.innerHTML = `<div class="spinner-container"><div class="spinner"></div><p class="loading-text">Loading...</p></div>`;
  const match = relativePath.match(/\/download\/page\/(\d+)\/?$/);
  const fullUrl = match ? `https://dubmv.top/download/file/${match[1]}` : baseUrl+relativePath;
  const apiUrl = "https://api.allorigins.win/get?url="+encodeURIComponent(fullUrl);

  for(let attempt=1; attempt<=retryCount; attempt++){
    try{
      const res = await fetch(apiUrl);
      if(!res.ok) throw new Error("Network Error");
      const data = await res.json();
      const html = data.contents;
      const doc = new DOMParser().parseFromString(html,"text/html");

      if(match){
        const downloadSection = doc.querySelector("div.download");
        let downloadHTML = `<div class="category-item"><strong>Download Links</strong><br><br>`;
        if(downloadSection){
          downloadSection.querySelectorAll("a[href]").forEach(a=>{
            const text = a.textContent.toLowerCase(); const href = a.getAttribute("href");
            if(!href || text.includes("watch online")) return;
            downloadHTML += `<div><a href="#" onclick="handleFinalDownload('${href}'); return false;" style="color:lime">${a.textContent.replace(/isaiDub\.me/gi,"MoviesAroDub")}</a></div>`;
          });
        }
        downloadHTML += `</div>`;
        container.innerHTML = downloadHTML; return;
      }

      let contentHTML="";
      doc.querySelectorAll("div.f").forEach(div=>{
        const table = div.querySelector("table");
        if(table){
          const img = table.querySelector("img"); const anchor = table.querySelector("a");
          const sizeMatch = table.innerText.match(/Size\s*:\s*([0-9.]+ [A-Z]+)?/); const size = sizeMatch ? sizeMatch[0] : "";
          contentHTML += `<div class="movie-item"><img src="https://isaidub.city${img.getAttribute("src")}" alt="${img.alt}"><div class="movie-info"><a href="#" onclick="loadPage('${anchor.getAttribute("href")}');return false;">${anchor.textContent.replace(/isaiDub\.me/gi,"MoviesAroDub")}</a><br><small>${size}</small></div></div>`;
        } else {
          const aTag = div.querySelector("a");
          if(aTag) contentHTML += `<div class="category-item"><div class="movie-info"><a href="#" onclick="loadPage('${aTag.getAttribute("href")}');return false;">${aTag.innerHTML}</a></div></div>`;
        }
      });

      let paginationHTML="";
      const paginationDiv = doc.querySelector("div.isaiminida");
      if(paginationDiv){
        paginationHTML=`<div class="pagination">Pages: `;
        paginationDiv.querySelectorAll("span,a").forEach(item=>{
          if(item.tagName==="SPAN") paginationHTML+=`<span class="pagination_current">${item.textContent}</span>`;
          else paginationHTML+=` <a href="#" onclick="loadPage('${item.getAttribute("href")}');return false;">${item.textContent}</a>`;
        });
        paginationHTML+=`</div>`;
      }

      container.innerHTML=contentHTML+paginationHTML; return;
    } catch(e){ console.warn(`Attempt ${attempt} failed: ${e.message}`);
      if(attempt===retryCount) container.innerHTML=`<p class="error">‚ùå Unable to load after ${retryCount} tries.</p>`;
    }
  }
}

// Back button
function goBack(){ if(pageHistory.length>1){ pageHistory.pop(); const previous=pageHistory.pop(); loadPage(previous,true); } else{ window.location.href='/'; } }

// Handle download
function handleFinalDownload(url){ actualDownloadUrl=url; document.getElementById("popup").style.display="flex"; }

// Confirm popup
function confirmRedirect(){ document.getElementById("popup").style.display="none"; window.open("https://otieu.com/4/9535254","_blank"); setTimeout(()=>{ window.open(actualDownloadUrl,"_blank"); },5000); }

// Initial load
loadPage("/tamil-yearly-dubbed-movies/");

// üîπ Anti-Inspect Protection
document.addEventListener("contextmenu", e=>e.preventDefault());
document.addEventListener("keydown", e=>{
  if(e.key==="F12" || (e.ctrlKey && e.shiftKey && ["I","J","C"].includes(e.key.toUpperCase())) || (e.ctrlKey && e.key==="U")) e.preventDefault();
});
</script>

</body>
</html>
